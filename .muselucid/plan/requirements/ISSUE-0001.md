# ISSUE-0001 要件仕様

## 対象ユーザー
- 営業アシスタント2名

## 現状課題
- 営業アシスタント2名が受注メール内容を基幹システムへ手入力している。
- 平日は1日120件前後を処理している。
- 処理遅延と転記ミスが毎週発生している。

## 目標状態
- メール受信後すぐに受注データが基幹システムへ自動登録される。
- 営業アシスタントは登録結果の確認のみで業務を完了できる。

## 業務フロー
1. 受注メールを受信する。
2. 受注データを抽出する。
3. 必須項目と重複を検証する。
4. 検証を通過したデータを登録する。
5. 登録結果を担当者へ表示する。

## 機能要件

### 正常系
- 受注番号と顧客コードが入力され、かつ同一受注番号が未登録の場合、受注データを保存する。
- 登録成功時に `reception_id` と `processed_at` を返却する。

### 異常系
- 受注番号または顧客コードが未入力の場合、登録せずエラーを表示する。
- 同一受注番号が既に存在する場合、重複警告を表示して保存しない。
- API応答が10秒を超えた場合、タイムアウトとして再実行導線を表示する。

### I/O仕様
| 要件ID | 条件 | 挙動 | 出力 |
| --- | --- | --- | --- |
| FR-001 | `order_number` または `customer_code` が空 | 登録処理を中断する | `status=error`、`code=REQUIRED_MISSING`、`message=受注番号と顧客コードは必須です` |
| FR-002 | FR-001を通過し、`order_number` が既存データと一致 | 保存しない | `status=warning`、`code=DUPLICATE_ORDER`、`message=同一受注番号が既に登録されています` |
| FR-003 | FR-001とFR-002を通過 | 受注データを保存する | `status=success`、`reception_id`(文字列)、`processed_at`(ISO-8601形式の日時文字列) |
| FR-004 | 受注取込画面から登録APIを呼び出して10秒を超えても応答がない | 画面側でタイムアウトとして結果待機を終了する | 画面表示: `処理がタイムアウトしました。再実行してください。`、操作: 再実行ボタンを表示 |

### 判定順序
1. FR-001（必須チェック）を実行する。
2. FR-001を通過した場合のみFR-002（重複チェック）を実行する。
3. FR-001とFR-002を通過した場合にFR-003（登録）を実行する。
4. FR-004は登録API呼び出しごとに監視し、10秒超過時に適用する。

## 非機能要件
- タイムアウト閾値は10秒とする。
- タイムアウト判定主体は受注取込画面とする。
- タイムアウト時は担当者が同じ入力データで再実行できること。

## 受け入れ基準
- 対象ユーザー、現状課題、目標状態が相互に矛盾しない。
- FR-001からFR-004までの条件、挙動、出力が実装可能な粒度で定義されている。
- 成功時レスポンスに `reception_id` と `processed_at` が含まれる。
- タイムアウト条件が「10秒超過」として明記され、再実行導線の表示要件がある。

### 受け入れ基準トレーサビリティ
| 受け入れ基準 | 対応箇所 |
| --- | --- |
| 対象ユーザー、現状課題、目標状態が相互に矛盾しない | `対象ユーザー`、`現状課題`、`目標状態` |
| 必須、重複、成功、タイムアウトの4要件が条件・挙動・出力で定義されている | `機能要件 > I/O仕様` の FR-001 から FR-004 |
| 成功時レスポンスに `reception_id` と `processed_at` が含まれる | FR-003 |
| タイムアウト条件が「10秒超過」として明記され、再実行導線の表示要件がある | FR-004、`非機能要件` |

## 未決事項
- なし
