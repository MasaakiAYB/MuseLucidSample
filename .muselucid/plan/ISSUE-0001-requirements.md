# ISSUE-0001 要件仕様書（MVP）

## 背景/課題
### As-Is（現状）
- 対象ユーザーは営業アシスタント2名。
- 受注メール内容を基幹システムへ手入力している。
- 平日は1日約120件を処理しており、処理遅延と転記ミスが毎週発生している。

### 課題
- 手入力がボトルネックとなり、処理完了までに待ち時間が発生する。
- 転記作業に起因する入力ミスを防ぎきれない。

## 目的
受注メール受信後の登録処理を自動化し、営業アシスタントは登録結果の確認のみで業務完了できる状態を実現する。

## スコープ
### 対象
- 受注メールを起点とした基幹システムへの受注登録MVP。
- 以下4要件の実装可能な仕様定義。
  - 必須入力（受注番号・顧客コード）
  - 重複検知（同一受注番号）
  - 登録成功時レスポンス（受付ID・処理時刻）
  - API応答10秒超過時のタイムアウト制御（再実行導線表示）

### 対象外
- 実API/画面/基幹システム連携の実装。
- 性能試験自動化の実装。
- Issue #5 以外の機能追加。

## 要件トレーサビリティ
| Issue要求 | 要件ID | 記載箇所 |
|---|---|---|
| 受注番号と顧客コードが未入力なら登録せずエラー表示する | FR-01 | 機能要件 FR-01 |
| 同一受注番号が既に存在する場合は重複警告を表示して保存しない | FR-02 | 機能要件 FR-02 |
| 登録成功時は受付IDと処理時刻を返却する | FR-03 | 機能要件 FR-03 |
| API応答が10秒を超えたらタイムアウトとして再実行導線を表示する | FR-04 | 機能要件 FR-04 |

## 機能要件
### FR-01: 必須入力チェック
- 入力: 受注番号、顧客コード。
- 判定条件: いずれかが未入力（空文字/null）の場合。
- システム動作: 登録処理を開始せず、エラー状態で終了する。
- ユーザー表示: 「受注番号と顧客コードは必須です」を表示する。
- 保存有無（副作用）: 保存しない。

### FR-02: 重複チェック
- 入力: 受注番号。
- 判定条件: 同一受注番号が既存データに存在する場合。
- システム動作: 保存処理を実行しない。
- ユーザー表示: 「同一受注番号が既に登録されています」を警告表示する。

### FR-03: 登録成功レスポンス
- 入力: FR-01/FR-02を通過した受注データ。
- 判定条件: 登録APIが正常終了する場合。
- システム動作: 登録完了として受付IDを採番し、処理時刻を記録して返却する。
- ユーザー表示: 登録成功メッセージとともに受付ID・処理時刻を表示する。
- 保存有無（副作用）: 保存する。
- 返却形式:
  - 受付ID: 文字列、一意。
  - 処理時刻: ISO 8601形式（例: `2026-02-24T11:59:42Z`）。
- 返却例:
```json
{
  "status": "success",
  "receptionId": "RCPT-20260224-000123",
  "processedAt": "2026-02-24T11:59:42Z"
}
```

### FR-04: タイムアウト制御
- 入力: 登録API呼び出し。
- 判定条件: API応答開始から10秒を超えても完了レスポンスを受信しない場合。
- システム動作: タイムアウトとして処理を中断し、失敗状態で終了する。
- ユーザー表示: 「タイムアウトしました。再実行してください」を表示し、再実行操作を可能にする。
- 保存有無（副作用）: 保存しない。

### バリデーション順序
1. 必須入力チェック（FR-01）
2. 重複チェック（FR-02）
3. 登録API呼び出し開始とタイムアウト監視開始（FR-04）
4. 10秒以内に完了レスポンス受信時のみ成功処理を確定（FR-03）
5. 10秒超過時はタイムアウトとして失敗終了（FR-04）

## 非機能要件
- 応答時間制約: 登録APIは10秒以内に完了レスポンスを返すことを期待し、10秒超過時はタイムアウトとして扱う。
- 監査可能性: 成功時の受付IDと処理時刻を追跡可能であること。
- 一貫性: エラー時は保存処理が行われないこと。

## 受け入れ条件
- AC-01: 対象ユーザー、現状課題、目標状態（確認中心業務への移行）が矛盾なく記述されている。
- AC-02: FR-01からFR-04が、実装担当者が直接タスク化できる粒度で定義されている。
- AC-03: 曖昧語を使用せず、10秒基準で測定可能な記述になっている。
- AC-04: エラー時の保存抑止、成功時の返却項目、タイムアウト時の再実行導線が明文化されている。

## 検証観点
- VC-01: 必須入力が欠ける入力データで登録されないことを確認する。
- VC-02: 既存受注番号を投入し、保存されず重複警告が表示されることを確認する。
- VC-03: 正常データで受付IDとISO 8601形式の処理時刻が返ることを確認する。
- VC-04: API応答を10秒超に遅延させ、タイムアウト表示と再実行導線を確認する。

## 未決事項
- 再実行導線の具体的UI（ボタン配置・遷移先）は画面設計で確定する。
- 重複判定対象のデータ保持期間は運用要件に合わせて別途確定する。
