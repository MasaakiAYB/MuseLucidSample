# ISSUE-0001 要件仕様書

## 1. 背景
営業アシスタント2名が受注メール内容を基幹システムへ手入力している。平日は1日約120件を処理しており、当日処理遅延と転記ミスが毎週発生している。

## 2. 対象ユーザー・課題・目標
- 対象ユーザー: 営業アシスタント
- 現状課題: 受注メールから基幹システムへの手入力がボトルネックとなり、遅延と転記ミスが発生している。
- 目標状態: メール受信後に受注情報を自動登録し、担当者は確認のみで処理完了できる。
- KPI定義（処理完了率95%以上）
  - 測定期間: 平日1日単位
  - 分母: 当日9:00-18:00に受信した受注メール総数
  - 分子: 当日中に「登録成功」ステータスになった件数
  - 算出式: 分子 / 分母 * 100
  - 合格基準: 95%以上

## 3. スコープ
### 3.1 対象
- 概要ヒアリング結果をMVP実装可能な要件仕様へ落とし込む。
- 必須チェック（受注番号、顧客コード）
- 重複チェック（同一受注番号）
- 登録成功時の返却（受付ID、処理時刻）
- API応答10秒超過時のタイムアウトと再実行導線
- 一覧画面でのステータス別件数表示

### 3.2 対象外
- モバイルアプリ対応
- AIによる需要予測分析

## 4. 機能要件
### FR-01 受注番号・顧客コード必須チェック
- 入力: 受注メールから抽出した受注番号、顧客コード
- 判定条件: いずれかが空文字、null、または未抽出
- 処理: 基幹システムへの登録API呼び出しを中止する
- 出力: エラー種別 `REQUIRED_FIELD_MISSING` を返却する
- エラー時挙動: 画面に「受注番号と顧客コードを入力してください」を表示し、未登録状態のままとする

### FR-02 同一受注番号の重複チェック
- 入力: 受注番号
- 判定条件: 既存レコードに同一受注番号が1件以上存在
- 処理: 新規保存処理を中止する
- 出力: 警告種別 `DUPLICATE_ORDER_NUMBER` を返却する
- エラー時挙動: 画面に重複警告を表示し、保存しない

### FR-03 登録成功レスポンス
- 入力: FR-01とFR-02を満たした受注データ
- 判定条件: 基幹システム登録APIが正常終了
- 処理: 登録結果を受領し、受付IDと処理時刻を整形する
- 出力: `receipt_id`、`processed_at` を返却する
- エラー時挙動: 正常終了以外はFR-01/FR-02/FR-04のエラー処理へ委譲する

### FR-04 APIタイムアウト時の再実行導線
- 入力: 基幹システム登録API呼び出し
- 判定条件: API応答時間が10秒を超過
- 処理: 呼び出しをタイムアウトとして打ち切る
- 出力: エラー種別 `API_TIMEOUT` を返却する
- エラー時挙動: 画面に「処理がタイムアウトしました。再実行してください」を表示し、再実行ボタンを有効化する

### FR-05 一覧画面ステータス別件数表示
- 入力: 当日受信分の処理結果一覧
- 判定条件: 一覧画面表示要求が発生
- 処理: ステータス別（登録成功、必須エラー、重複、タイムアウト）の件数を集計する
- 出力: 各ステータス件数を一覧画面ヘッダーへ表示する
- エラー時挙動: 集計失敗時は「件数を取得できませんでした」を表示し、一覧本体表示は継続する

## 5. 非機能要件
- NFR-01 性能: 1件あたりの登録API待機は10秒でタイムアウトする。
- NFR-02 可用性: タイムアウト時に担当者が同一画面から再実行できること。
- NFR-03 監査性: 受付IDと処理時刻を操作ログへ記録し、処理結果を追跡できること。

## 6. 制約条件
- C-01 個人情報は保存前にマスキングする。
  - 対象: 氏名、メールアドレス、電話番号、住所
  - 責務: 保存処理の直前にアプリケーション層でマスキングする
- C-02 既存基幹システムのDBスキーマは変更しない。
  - 方針: 既存カラムへのマッピングのみを許可し、追加カラム前提の設計を禁止する
- C-03 2か月以内に本番導入する。
  - 方針: 本仕様外の追加要求は別Issue化し、MVP範囲を維持する

## 7. 受け入れ基準（テスト可能形式）
### AC-01 対象ユーザー・課題・目標の整合
- Given: 要件仕様書の「対象ユーザー・課題・目標」章をレビューする
- When: 主語、対象、成功条件を確認する
- Then: 矛盾する記述がなく、処理完了率95%以上の測定定義が明記されている

### AC-02 機能要件の実装粒度
- Given: FR-01からFR-05を確認する
- When: 各要件の入力、判定条件、処理、出力、エラー時挙動を確認する
- Then: 5観点が全要件で欠けず、実装時の解釈差が発生しない

### AC-03 受入条件（一覧画面）
- Given: 一覧画面を表示する
- When: 処理結果が存在する
- Then: ステータス別件数を確認できる

## 8. 検証
- 要件レビューで曖昧な記述が残っていないことを確認する。
- 禁止語一覧に該当する語を本文に含まないことを確認する。

## 9. トレーサビリティ
| 課題 | 要件ID | 受け入れ基準 | 検証項目 |
| --- | --- | --- | --- |
| 手入力による遅延・転記ミス | FR-01 | AC-02 | 必須欠落時に未登録となること |
| 手入力による遅延・転記ミス | FR-02 | AC-02 | 同一受注番号が保存されないこと |
| 自動登録結果の追跡不足 | FR-03 | AC-02 | 成功時に受付IDと処理時刻が返却されること |
| 外部API遅延で処理停止 | FR-04 | AC-02 | 10秒超過でタイムアウトし再実行導線が出ること |
| 日次処理の把握困難 | FR-05 | AC-03 | 一覧画面でステータス別件数を確認できること |
| 目標達成状況の不明確さ | KPI定義 | AC-01 | 分母・分子・測定期間で95%以上を判定できること |

## 10. Issueメタ情報整合
- `.muselucid/plan/issues/ISSUE-0001.yaml` の `scope`、`acceptance_criteria`、`verify`、`non_goals`、`risk` と整合している。
- 本仕様はIssueで定義されたMVP範囲のみを扱う。
