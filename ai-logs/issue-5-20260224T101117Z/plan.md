## 1. スコープ（対象/対象外）

### 対象
- 概要ヒアリング結果を、実装可能な要件仕様として文書化すること
- 対象ユーザー・課題・目標状態の明確化
- MVP機能要件の明確化  
  - 必須チェック（受注番号/顧客コード）  
  - 重複チェック（同一受注番号）  
  - 成功時返却値（受付ID/処理時刻）  
  - APIタイムアウト（10秒）時の再実行導線  
  - 一覧画面でのステータス別件数表示
- 制約条件の明文化  
  - 個人情報マスキング  
  - 既存基幹DBスキーマ不変更  
  - 2か月以内の本番導入

### 対象外
- モバイルアプリ対応
- AIによる需要予測分析
- 実装コード作成（本Issueでは仕様確定まで）

---

## 2. 実装手順（番号付き、各手順に完了条件）

1. 要件仕様書の雛形を作成する  
完了条件: `.muselucid/plan/specs/ISSUE-0001-requirements.md` を新規作成し、章立て（背景/スコープ/機能要件/非機能要件/制約/受入基準/検証）を配置済み。

2. ヒアリング内容を「業務要件」に正規化する  
完了条件: 対象ユーザー、現状課題、目標（95%以上）を定量表現で記載し、主語・対象・成功条件が曖昧語なしで記載済み。

3. 機能要件を実装粒度で定義する  
完了条件: 各機能要件に対して「入力」「判定条件」「処理」「出力」「エラー時挙動」を記載し、以下5要件が個別ID付きで定義済み。  
- 必須未入力エラー  
- 重複警告  
- 成功レスポンス（受付ID/処理時刻）  
- 10秒タイムアウトと再実行導線  
- 一覧画面ステータス件数表示

4. 制約・非機能要件を設計制約に落とし込む  
完了条件: 個人情報マスキング対象、DBスキーマ不変更方針、2か月導入前提のスケジュール制約が、実装判断に使える文で明文化済み。

5. 受け入れ基準（DoD）をテスト可能な形へ変換する  
完了条件: 各受け入れ基準が Given/When/Then または同等の検証可能形式で記述され、曖昧な記述がない。

6. トレーサビリティを作成する  
完了条件: 「課題→要件→受入基準→検証項目」の対応表を仕様書内に追加し、漏れがないことをセルフチェック済み。

7. Issueメタ情報との整合確認を行う  
完了条件: `.muselucid/plan/issues/ISSUE-0001.yaml` の scope/constraints/acceptance_criteria と仕様書記載が一致し、差分理由が残っていない。

---

## 3. リスクと対策

- リスク: 要件文が抽象的で実装解釈が分かれる  
対策: 各要件を「条件・処理・結果」で記述し、曖昧語（適切に、迅速に等）を禁止する。

- リスク: 95%達成条件の測定定義が不明  
対策: 分母/分子/測定期間（平日1日単位など）を仕様に明記する。

- リスク: DBスキーマ不変更制約により実装方式が破綻  
対策: 保存項目と既存カラムのマッピング表を作り、追加カラム前提を禁止する。

- リスク: 個人情報マスキング範囲の漏れ  
対策: マスキング対象フィールド一覧と保存前処理の責務を仕様に固定する。

- リスク: 2か月以内導入に対し仕様肥大化  
対策: MVP境界（対象/対象外）を冒頭に固定し、追加要求は別Issue化する。

---

## 4. 検証計画（実行コマンドと期待結果）

1. 仕様書の存在確認
```bash
test -f .muselucid/plan/specs/ISSUE-0001-requirements.md && echo OK
```
期待結果: `OK` が出力される。

2. 必須要件キーワード網羅確認
```bash
rg -n "受注番号|顧客コード|重複|受付ID|処理時刻|10秒|再実行|ステータス別件数|95%" .muselucid/plan/specs/ISSUE-0001-requirements.md
```
期待結果: 上記キーワードがすべて1回以上ヒットする。

3. 制約反映確認
```bash
rg -n "個人情報.*マスキング|DBスキーマ.*変更しない|2か月以内" .muselucid/plan/specs/ISSUE-0001-requirements.md
```
期待結果: 3制約すべてがヒットする。

4. 曖昧語・未確定語の残存確認
```bash
rg -n "TODO|TBD|未定|要確認|調整中|適宜|可能であれば" .muselucid/plan/specs/ISSUE-0001-requirements.md
```
期待結果: ヒット0件。

5. Issue定義との整合確認
```bash
diff -u .muselucid/plan/issues/ISSUE-0001.yaml <(yq -o=yaml '.' .muselucid/plan/issues/ISSUE-0001.yaml) >/dev/null; echo $?
```
期待結果: `0`（YAML自体が壊れていない）。  
補助確認:
```bash
rg -n "scope:|constraints:|acceptance_criteria:" .muselucid/plan/issues/ISSUE-0001.yaml
```
期待結果: 各セクションが存在する。